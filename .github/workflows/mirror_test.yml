name: mirrortest

on:
  push:
    branches:
      - ouproj_template

jobs:
  mirror:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout source code
      uses: actions/checkout@v2

    - name: Mirror repository
      run: |
        git clone --mirror https://github.com/rmgpanw/ourproj

        pwd

        cd ourproj.git

        pwd

        echo "set git config"
        git config --local user.name "Your Name"
        git config --local user.email "your-email@example.com"

        # Check if remote origin already exists
        echo "add remote origin"
        REMOTE_ORIGIN_EXISTS=$(git remote -v | grep origin)
        if [ -z "$REMOTE_ORIGIN_EXISTS" ]; then
          git remote add origin https://github.com/{TARGET_OWNER}/{TARGET_REPOSITORY}.git
        fi

        echo "list files in dir"
        ls -lah

        echo "push to destination repo"
        git push --set-upstream origin main
